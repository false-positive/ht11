import invariant from "tiny-invariant";
import { TickKind } from "./cases/index";

const etfPrices = [
	39.04556656, 40.56109619, 40.72795486, 42.65797806, 42.19408035,
	42.32662201, 41.52931213, 43.44632339, 43.22200775, 44.85276794,
	44.95143509, 45.68780899, 46.31180191, 44.81889725, 44.68447113,
	44.82493973, 45.85530853, 46.70093918, 48.54699326, 49.67788696, 50.0203743,
	51.21064377, 50.37877274, 50.72657013, 52.99245071, 54.96580887,
	53.79186249, 52.08829117, 52.85460663, 54.65477371, 55.87154388,
	53.34496689, 52.69155121, 49.70806122, 48.46719742, 47.8102684, 50.38025665,
	51.3959465, 46.99956512, 46.92744827, 47.61267471, 43.00024796, 35.66015244,
	32.80200195, 33.12779999, 30.69529533, 27.46460152, 29.53136826,
	33.00469971, 34.80781937, 34.76273346, 37.63873291, 39.03556061,
	40.46257782, 39.57957458, 41.83239365, 42.75775909, 41.49573517,
	42.92322159, 45.48806, 46.6647644, 42.98614502, 40.28084946, 43.31715775,
	41.27644348, 44.94972992, 47.00177765, 47.24172592, 50.26063156,
	51.56451035, 53.47112656, 53.47112656, 55.25004959, 54.66394043, 53.4526825,
	52.46378708, 49.26966095, 45.29856873, 50.71453857, 50.52519989,
	50.73032379, 53.60552979, 55.86685944, 57.33474731, 57.21414948,
	53.65218353, 55.54074478, 56.31104279, 57.83274078, 58.98602295,
	58.20318222, 58.65388107, 58.97580719, 62.63086319, 63.43353271,
	65.63877106, 66.99699402, 68.63404083, 67.3309021, 71.53479767, 69.36636353,
	71.72303772, 75.14485931, 77.17576599, 78.86960602, 76.7726059, 80.50872803,
	80.56659698, 80.96859741, 82.6705246, 84.48861694, 83.14523315, 86.59642029,
	84.39563751, 87.10884857, 89.26938629, 88.76695251, 86.79387665,
	91.77755737, 90.2875061, 91.26850891, 92.45259857, 90.51574707, 92.45005798,
	86.81846619, 83.85401917, 90.9484787, 91.49488831, 89.04463959, 84.42618561,
	84.41757202, 89.99848175, 91.0147934, 92.59336853, 92.43811798, 96.53754425,
	96.73680115, 96.45957184, 94.80505371, 99.06253052, 100.4033356,
	102.9054031, 106.7075958, 106.2871094, 107.901825, 108.9930801, 109.5210953,
	112.0943451, 112.2623367, 114.5079193, 117.4966278, 121.057106, 121.8650665,
	128.8690491, 124.0240707, 121.0974808, 122.135788, 125.4595108, 125.8089066,
	130.534729, 135.0151672, 134.6372986, 125.2548218, 127.7769394, 115.3744125,
	125.9631882, 130.4459991, 131.5825348, 137.4865875, 128.6188965,
	137.2123871, 139.6679688, 136.759201, 138.5576782, 142.1238861, 147.5072327,
	150.8257294, 151.5508423, 139.4282837, 119.4741821, 135.83638, 143.1665649,
	145.7930603, 154.8682098, 165.8714294, 159.3499603, 156.8845367,
	175.4017487, 182.8612671, 182.9909973, 188.7356415, 194.9709015, 205.473114,
	206.41008, 210.8867493, 215.2071075, 221.3588715, 210.8115997, 225.6193542,
	222.3242645, 229.9334412, 216.7743988, 211.3839264, 217.596344, 198.342865,
	197.8443298, 180.8363647, 198.5292358, 191.1271515, 172.7517395,
	187.5596161, 197.2551422, 184.8143158, 198.5655212, 193.7963715,
	198.2449951, 201.1881409, 202.0463257, 214.8217468, 223.5415039,
	219.2243652, 207.9371796, 203.1773987, 222.3072662, 233.0758057,
	236.6908264, 249.2323761, 256.4553223, 246.1771088, 257.8913269,
	264.8921509, 270.8598633, 276.6333923, 281.3833923, 280.1282959,
	298.8978882, 288.880127, 298.6000061, 292.9599915, 278.7399902,
];

function getByMonth(tick: number, prices: number[]) {
	return prices[tick];
}

function getByYear(tick: number, prices: number[]) {
	return prices[tick * 12];
}

function getByWeek(tick: number, prices: number[]) {
	const lowMonth = Math.floor(tick / 4);
	const low = prices[lowMonth];
	const high = prices[lowMonth + 1];
	const weekInMonth = tick % 4;

	return low + ((high - low) * weekInMonth) / 4;
}

function getBeforeAfter(tick: number, prices: number[], tickKind: TickKind) {
	let getter;
	if (tickKind == "week") {
		getter = getByWeek;
	} else if (tickKind == "month") {
		getter = getByMonth;
	} else getter = getByYear;

	return {
		before: getter(tick - 1, prices),
		after: getter(tick, prices),
	};
}

export function getPercent(tick: number, tickKind: TickKind, prices: number[]) {
	const { before, after } = getBeforeAfter(tick, prices, tickKind);

	const percentChange = ((after - before) / before) * 100;
	return percentChange;
}

export function getPrices(investment: string) {
	if (investment == "etf") return etfPrices;
	invariant(false, "No historical data for investment");
}
